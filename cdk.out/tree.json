{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.221.0"},"children":{"CHLBStack":{"id":"CHLBStack","path":"CHLBStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.221.0"},"children":{"DefaultVPC":{"id":"DefaultVPC","path":"CHLBStack/DefaultVPC","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]},"children":{"PublicSubnet1":{"id":"PublicSubnet1","path":"CHLBStack/DefaultVPC/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"PublicSubnet2":{"id":"PublicSubnet2","path":"CHLBStack/DefaultVPC/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"PublicSubnet3":{"id":"PublicSubnet3","path":"CHLBStack/DefaultVPC/PublicSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"PublicSubnet4":{"id":"PublicSubnet4","path":"CHLBStack/DefaultVPC/PublicSubnet4","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"PublicSubnet5":{"id":"PublicSubnet5","path":"CHLBStack/DefaultVPC/PublicSubnet5","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"PublicSubnet6":{"id":"PublicSubnet6","path":"CHLBStack/DefaultVPC/PublicSubnet6","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}}}},"CHLBSecurityGroup":{"id":"CHLBSecurityGroup","path":"CHLBStack/CHLBSecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CHLBStack/CHLBSecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"Allow SSH, LB ports, and backend ports","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":22,"toPort":22,"description":"SSH access"},{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":5000,"toPort":5000,"description":"Load Balancer port"},{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":8080,"toPort":8080,"description":"Backend app port"}],"vpcId":"vpc-0af5da03412be250b"}}}}},"EC2Role":{"id":"EC2Role","path":"CHLBStack/EC2Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.221.0","metadata":[]},"children":{"ImportEC2Role":{"id":"ImportEC2Role","path":"CHLBStack/EC2Role/ImportEC2Role","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"Resource":{"id":"Resource","path":"CHLBStack/EC2Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonS3ReadOnlyAccess"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/CloudWatchAgentServerPolicy"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"CHLBStack/EC2Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CHLBStack/EC2Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"ec2:DescribeInstances","Effect":"Allow","Resource":"*"},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::cdk-hnb659fds-assets-231545823700-us-east-1"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::cdk-hnb659fds-assets-231545823700-us-east-1/*"]]}]}],"Version":"2012-10-17"},"policyName":"EC2RoleDefaultPolicy64E44857","roles":[{"Ref":"EC2RoleF978FC1C"}]}}}}}}},"EC2InstanceProfile":{"id":"EC2InstanceProfile","path":"CHLBStack/EC2InstanceProfile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"instanceProfileName":"CHLBStack-ec2-profile","roles":[{"Ref":"EC2RoleF978FC1C"}]}}},"ScriptsAsset":{"id":"ScriptsAsset","path":"CHLBStack/ScriptsAsset","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.221.0"},"children":{"Stage":{"id":"Stage","path":"CHLBStack/ScriptsAsset/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.221.0"}},"AssetBucket":{"id":"AssetBucket","path":"CHLBStack/ScriptsAsset/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.221.0","metadata":[]}}}},"Backend1":{"id":"Backend1","path":"CHLBStack/Backend1","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Instance","version":"2.221.0","metadata":[]},"children":{"InstanceRole":{"id":"InstanceRole","path":"CHLBStack/Backend1/InstanceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.221.0","metadata":[]},"children":{"ImportInstanceRole":{"id":"ImportInstanceRole","path":"CHLBStack/Backend1/InstanceRole/ImportInstanceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"Resource":{"id":"Resource","path":"CHLBStack/Backend1/InstanceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"tags":[{"key":"Name","value":"CHLBStack/Backend1"}]}}}}},"InstanceProfile":{"id":"InstanceProfile","path":"CHLBStack/Backend1/InstanceProfile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"Backend1InstanceRole9F570CD5"}]}}},"Resource":{"id":"Resource","path":"CHLBStack/Backend1/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInstance","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Instance","aws:cdk:cloudformation:props":{"availabilityZone":"us-east-1a","iamInstanceProfile":{"Ref":"Backend1InstanceProfile72F98172"},"imageId":{"Ref":"SsmParameterValueawsserviceamiamazonlinuxlatestamznamihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"t3.micro","keyName":"Demo","securityGroupIds":[{"Fn::GetAtt":["CHLBSecurityGroupD4E81CDE","GroupId"]}],"subnetId":"subnet-0646c4672d51c90c2","tags":[{"key":"Name","value":"CHLBStack/Backend1"}],"userData":{"Fn::Base64":"#!/bin/bash -xe\nyum update -y || true\namazon-linux-extras enable python3.8 -y || true\nyum install -y python3 unzip amazon-cloudwatch-agent -y\npip3 install flask requests pymongo boto3\naws s3 cp s3://cdk-hnb659fds-assets-231545823700-us-east-1/aa6450eb944ae8c34e72ae7793ff99ee1c01fd16a8da15231e99d03aa01953b1.zip /home/ec2-user/scripts.zip\ncd /home/ec2-user\nunzip -o scripts.zip -d scripts\ncat <<'EOF' > /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json\n{\n  \"logs\": {\n    \"logs_collected\": {\n      \"files\": {\n        \"collect_list\": [\n          {\"file_path\": \"/home/ec2-user/backend.log\", \"log_group_name\": \"CHLB_BackendLogs\", \"log_stream_name\": \"Backend-1\"}\n        ]\n      }\n    }\n  }\n}\nEOF\nsystemctl enable amazon-cloudwatch-agent\nsystemctl start amazon-cloudwatch-agent\nSERVER_NAME=Backend-1 nohup python3 /home/ec2-user/scripts/backend_app.py > /home/ec2-user/backend.log 2>&1 &"}}}}}},"SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter":{"id":"SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","path":"CHLBStack/SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.221.0"}},"SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118":{"id":"SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118","path":"CHLBStack/SsmParameterValue:--aws--service--ami-amazon-linux-latest--amzn-ami-hvm-x86_64-gp2:C96584B6-F00A-464E-AD19-53AFF4B05118","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"Backend2":{"id":"Backend2","path":"CHLBStack/Backend2","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Instance","version":"2.221.0","metadata":[]},"children":{"InstanceRole":{"id":"InstanceRole","path":"CHLBStack/Backend2/InstanceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.221.0","metadata":[]},"children":{"ImportInstanceRole":{"id":"ImportInstanceRole","path":"CHLBStack/Backend2/InstanceRole/ImportInstanceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"Resource":{"id":"Resource","path":"CHLBStack/Backend2/InstanceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"tags":[{"key":"Name","value":"CHLBStack/Backend2"}]}}}}},"InstanceProfile":{"id":"InstanceProfile","path":"CHLBStack/Backend2/InstanceProfile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"Backend2InstanceRoleAAD12628"}]}}},"Resource":{"id":"Resource","path":"CHLBStack/Backend2/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInstance","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Instance","aws:cdk:cloudformation:props":{"availabilityZone":"us-east-1a","iamInstanceProfile":{"Ref":"Backend2InstanceProfileC1C1F9D5"},"imageId":{"Ref":"SsmParameterValueawsserviceamiamazonlinuxlatestamznamihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"t3.micro","keyName":"Demo","securityGroupIds":[{"Fn::GetAtt":["CHLBSecurityGroupD4E81CDE","GroupId"]}],"subnetId":"subnet-0646c4672d51c90c2","tags":[{"key":"Name","value":"CHLBStack/Backend2"}],"userData":{"Fn::Base64":"#!/bin/bash -xe\nyum update -y || true\namazon-linux-extras enable python3.8 -y || true\nyum install -y python3 unzip amazon-cloudwatch-agent -y\npip3 install flask requests pymongo boto3\naws s3 cp s3://cdk-hnb659fds-assets-231545823700-us-east-1/aa6450eb944ae8c34e72ae7793ff99ee1c01fd16a8da15231e99d03aa01953b1.zip /home/ec2-user/scripts.zip\ncd /home/ec2-user\nunzip -o scripts.zip -d scripts\ncat <<'EOF' > /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json\n{\n  \"logs\": {\n    \"logs_collected\": {\n      \"files\": {\n        \"collect_list\": [\n          {\"file_path\": \"/home/ec2-user/backend.log\", \"log_group_name\": \"CHLB_BackendLogs\", \"log_stream_name\": \"Backend-2\"}\n        ]\n      }\n    }\n  }\n}\nEOF\nsystemctl enable amazon-cloudwatch-agent\nsystemctl start amazon-cloudwatch-agent\nSERVER_NAME=Backend-2 nohup python3 /home/ec2-user/scripts/backend_app.py > /home/ec2-user/backend.log 2>&1 &"}}}}}},"Backend3":{"id":"Backend3","path":"CHLBStack/Backend3","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Instance","version":"2.221.0","metadata":[]},"children":{"InstanceRole":{"id":"InstanceRole","path":"CHLBStack/Backend3/InstanceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.221.0","metadata":[]},"children":{"ImportInstanceRole":{"id":"ImportInstanceRole","path":"CHLBStack/Backend3/InstanceRole/ImportInstanceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"Resource":{"id":"Resource","path":"CHLBStack/Backend3/InstanceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"tags":[{"key":"Name","value":"CHLBStack/Backend3"}]}}}}},"InstanceProfile":{"id":"InstanceProfile","path":"CHLBStack/Backend3/InstanceProfile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"Backend3InstanceRole7FA01FFF"}]}}},"Resource":{"id":"Resource","path":"CHLBStack/Backend3/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInstance","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Instance","aws:cdk:cloudformation:props":{"availabilityZone":"us-east-1a","iamInstanceProfile":{"Ref":"Backend3InstanceProfile466BB2ED"},"imageId":{"Ref":"SsmParameterValueawsserviceamiamazonlinuxlatestamznamihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"t3.micro","keyName":"Demo","securityGroupIds":[{"Fn::GetAtt":["CHLBSecurityGroupD4E81CDE","GroupId"]}],"subnetId":"subnet-0646c4672d51c90c2","tags":[{"key":"Name","value":"CHLBStack/Backend3"}],"userData":{"Fn::Base64":"#!/bin/bash -xe\nyum update -y || true\namazon-linux-extras enable python3.8 -y || true\nyum install -y python3 unzip amazon-cloudwatch-agent -y\npip3 install flask requests pymongo boto3\naws s3 cp s3://cdk-hnb659fds-assets-231545823700-us-east-1/aa6450eb944ae8c34e72ae7793ff99ee1c01fd16a8da15231e99d03aa01953b1.zip /home/ec2-user/scripts.zip\ncd /home/ec2-user\nunzip -o scripts.zip -d scripts\ncat <<'EOF' > /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json\n{\n  \"logs\": {\n    \"logs_collected\": {\n      \"files\": {\n        \"collect_list\": [\n          {\"file_path\": \"/home/ec2-user/backend.log\", \"log_group_name\": \"CHLB_BackendLogs\", \"log_stream_name\": \"Backend-3\"}\n        ]\n      }\n    }\n  }\n}\nEOF\nsystemctl enable amazon-cloudwatch-agent\nsystemctl start amazon-cloudwatch-agent\nSERVER_NAME=Backend-3 nohup python3 /home/ec2-user/scripts/backend_app.py > /home/ec2-user/backend.log 2>&1 &"}}}}}},"LBInstance":{"id":"LBInstance","path":"CHLBStack/LBInstance","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Instance","version":"2.221.0","metadata":[]},"children":{"InstanceRole":{"id":"InstanceRole","path":"CHLBStack/LBInstance/InstanceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.221.0","metadata":[]},"children":{"ImportInstanceRole":{"id":"ImportInstanceRole","path":"CHLBStack/LBInstance/InstanceRole/ImportInstanceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"Resource":{"id":"Resource","path":"CHLBStack/LBInstance/InstanceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"tags":[{"key":"Name","value":"CHLBStack/LBInstance"}]}}}}},"InstanceProfile":{"id":"InstanceProfile","path":"CHLBStack/LBInstance/InstanceProfile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"LBInstanceInstanceRole41DC12B8"}]}}},"Resource":{"id":"Resource","path":"CHLBStack/LBInstance/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInstance","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Instance","aws:cdk:cloudformation:props":{"availabilityZone":"us-east-1a","iamInstanceProfile":{"Ref":"LBInstanceInstanceProfileA1C73FD3"},"imageId":{"Ref":"SsmParameterValueawsserviceamiamazonlinuxlatestamznamihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"t3.micro","keyName":"Demo","securityGroupIds":[{"Fn::GetAtt":["CHLBSecurityGroupD4E81CDE","GroupId"]}],"subnetId":"subnet-0646c4672d51c90c2","tags":[{"key":"Name","value":"CHLBStack/LBInstance"}],"userData":{"Fn::Base64":"#!/bin/bash -xe\nyum update -y || true\namazon-linux-extras enable python3.8 -y || true\nyum install -y python3 unzip amazon-cloudwatch-agent -y\npip3 install flask flask-socketio requests pymongo boto3\naws s3 cp s3://cdk-hnb659fds-assets-231545823700-us-east-1/aa6450eb944ae8c34e72ae7793ff99ee1c01fd16a8da15231e99d03aa01953b1.zip /home/ec2-user/scripts.zip\ncd /home/ec2-user\nunzip -o scripts.zip -d scripts\ncat <<'EOF' > /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json\n{\n  \"logs\": {\n    \"logs_collected\": {\n      \"files\": {\n        \"collect_list\": [\n          {\"file_path\": \"/home/ec2-user/lb.log\", \"log_group_name\": \"CHLB_LBLogs\", \"log_stream_name\": \"LoadBalancer\"},\n          {\"file_path\": \"/home/ec2-user/mongo_bootstrap.log\", \"log_group_name\": \"CHLB_LBLogs\", \"log_stream_name\": \"MongoBootstrap\"}\n        ]\n      }\n    }\n  }\n}\nEOF\nsystemctl enable amazon-cloudwatch-agent\nsystemctl start amazon-cloudwatch-agent\npython3 - <<'PY'\nimport boto3, json\nregion = 'us-east-1'\nec2 = boto3.client('ec2', region_name=region)\nres = ec2.describe_instances(Filters=[{'Name':'tag:Role','Values':['CHLBBackend']},{'Name':'instance-state-name','Values':['running']}])\nservers = []\nfor r in res['Reservations']:\n    for i in r['Instances']:\n        ip = i.get('PrivateIpAddress')\n        name = next((t['Value'] for t in i.get('Tags',[]) if t['Key']=='Name'), 'Unknown')\n        servers.append({'name': name, 'ip': ip, 'port': 8080})\nconf = f\"servers = {json.dumps(servers)}\\nMONGODB_URI = 'mongodb+srv://ruchithpraharshab23_db_user:Ruchith%402005@ccproject.waghehd.mongodb.net/chlb'\\nLB_PORT = 5000\\n\"\nwith open('/home/ec2-user/scripts/config.py','w') as f:\n    f.write(conf)\nprint('WROTE CONFIG:', conf)\nPY\nnohup python3 /home/ec2-user/scripts/mongo_bootstrap.py > /home/ec2-user/mongo_bootstrap.log 2>&1 &\nnohup python3 /home/ec2-user/scripts/lb.py > /home/ec2-user/lb.log 2>&1 &"}}}}}},"LambdaExecRole":{"id":"LambdaExecRole","path":"CHLBStack/LambdaExecRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.221.0","metadata":[]},"children":{"ImportLambdaExecRole":{"id":"ImportLambdaExecRole","path":"CHLBStack/LambdaExecRole/ImportLambdaExecRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"Resource":{"id":"Resource","path":"CHLBStack/LambdaExecRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/CloudWatchReadOnlyAccess"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonS3ReadOnlyAccess"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}}}},"HealthCheckerLambda":{"id":"HealthCheckerLambda","path":"CHLBStack/HealthCheckerLambda","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.221.0","metadata":[]},"children":{"Code":{"id":"Code","path":"CHLBStack/HealthCheckerLambda/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.221.0"},"children":{"Stage":{"id":"Stage","path":"CHLBStack/HealthCheckerLambda/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.221.0"}},"AssetBucket":{"id":"AssetBucket","path":"CHLBStack/HealthCheckerLambda/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.221.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"CHLBStack/HealthCheckerLambda/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-231545823700-us-east-1","s3Key":"aa6450eb944ae8c34e72ae7793ff99ee1c01fd16a8da15231e99d03aa01953b1.zip"},"environment":{"variables":{"MONGODB_URI":"mongodb+srv://ruchithpraharshab23_db_user:Ruchith%402005@ccproject.waghehd.mongodb.net/chlb","LB_IP":{"Fn::GetAtt":["LBInstance138DE3A0","PrivateIp"]}}},"handler":"health_checker.lambda_handler","role":{"Fn::GetAtt":["LambdaExecRoleA88165BD","Arn"]},"runtime":"python3.10","timeout":30}}}}},"WeightCalculatorLambda":{"id":"WeightCalculatorLambda","path":"CHLBStack/WeightCalculatorLambda","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.221.0","metadata":[]},"children":{"Code":{"id":"Code","path":"CHLBStack/WeightCalculatorLambda/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.221.0"},"children":{"Stage":{"id":"Stage","path":"CHLBStack/WeightCalculatorLambda/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.221.0"}},"AssetBucket":{"id":"AssetBucket","path":"CHLBStack/WeightCalculatorLambda/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.221.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"CHLBStack/WeightCalculatorLambda/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-231545823700-us-east-1","s3Key":"aa6450eb944ae8c34e72ae7793ff99ee1c01fd16a8da15231e99d03aa01953b1.zip"},"environment":{"variables":{"MONGODB_URI":"mongodb+srv://ruchithpraharshab23_db_user:Ruchith%402005@ccproject.waghehd.mongodb.net/chlb","LB_IP":{"Fn::GetAtt":["LBInstance138DE3A0","PrivateIp"]}}},"handler":"weight_calculator.lambda_handler","role":{"Fn::GetAtt":["LambdaExecRoleA88165BD","Arn"]},"runtime":"python3.10","timeout":30}}}}},"EveryMinuteRule":{"id":"EveryMinuteRule","path":"CHLBStack/EveryMinuteRule","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Rule","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CHLBStack/EveryMinuteRule/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnRule","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Rule","aws:cdk:cloudformation:props":{"scheduleExpression":"rate(1 minute)","state":"ENABLED","targets":[{"id":"Target0","arn":{"Fn::GetAtt":["HealthCheckerLambda7309016B","Arn"]}},{"id":"Target1","arn":{"Fn::GetAtt":["WeightCalculatorLambda26DF1CD5","Arn"]}}]}}},"AllowEventRuleCHLBStackHealthCheckerLambda636A6D50":{"id":"AllowEventRuleCHLBStackHealthCheckerLambda636A6D50","path":"CHLBStack/EveryMinuteRule/AllowEventRuleCHLBStackHealthCheckerLambda636A6D50","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["HealthCheckerLambda7309016B","Arn"]},"principal":"events.amazonaws.com","sourceArn":{"Fn::GetAtt":["EveryMinuteRule15D85929","Arn"]}}}},"AllowEventRuleCHLBStackWeightCalculatorLambdaA2A84BCA":{"id":"AllowEventRuleCHLBStackWeightCalculatorLambdaA2A84BCA","path":"CHLBStack/EveryMinuteRule/AllowEventRuleCHLBStackWeightCalculatorLambdaA2A84BCA","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["WeightCalculatorLambda26DF1CD5","Arn"]},"principal":"events.amazonaws.com","sourceArn":{"Fn::GetAtt":["EveryMinuteRule15D85929","Arn"]}}}}}},"LBPublicIP":{"id":"LBPublicIP","path":"CHLBStack/LBPublicIP","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.221.0"}},"BackendPrivateIPs":{"id":"BackendPrivateIPs","path":"CHLBStack/BackendPrivateIPs","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.221.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"CHLBStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"CHLBStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.221.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"CHLBStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.221.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"CHLBStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.221.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}